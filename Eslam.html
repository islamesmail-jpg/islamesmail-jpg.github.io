<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>قرية مورانو وادي دجلة العين السخنة - شاليهات وفيلات للبيع بالتقسيط | Islam Real Estate</title>
<meta name="description" content="اكتشف مشروع مورانو وادي دجلة في العين السخنة - شاليهات وفيلات فاخرة على البحر الأحمر. موقع متميز، شاطئ خاص 750م، أنظمة سداد مرنة. احجز وحدتك الآن">
<meta name="keywords" content="مورانو وادي دجلة, Murano Wadi Degla, شاليهات العين السخنة, وحدات للبيع بالتقسيط, عقارات السخنة, قرية مورانو">
<link rel="canonical" href="https://islamproperty.com/Eslam.html">
<link rel="icon" href="https://f.top4top.io/p_3562107rr0.png" type="image/png">

<!-- Open Graph -->
<meta property="og:title" content="قرية مورانو وادي دجلة العين السخنة | Islam Real Estate">
<meta property="og:description" content="شاليهات وفيلات فاخرة للبيع بالتقسيط في أجمل مواقع البحر الأحمر">
<meta property="og:image" content="https://c.top4top.io/p_35249hfap2.jpg">
<meta property="og:url" content="https://islamproperty.com/murano.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="قرية مورانو وادي دجلة العين السخنة">
<meta name="twitter:description" content="شاليهات وفيلات فاخرة بأنظمة سداد مرنة">
<meta name="twitter:image" content="https://c.top4top.io/p_35249hfap2.jpg">

<!-- Schema.org -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "RealEstateAgent",
  "name": "Islam Real Estate - مورانو وادي دجلة",
  "description": "شاليهات وفيلات للبيع في قرية مورانو وادي دجلة العين السخنة",
  "url": "https://islamproperty.com/murano.html",
  "telephone": "+201050072527",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "العين السخنة",
    "addressCountry": "EG"
  }
}
</script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --wrap:1140px;
  --line:#e5e7eb;
  --ink:#0b1724;
  --muted:#374151;
  --primary:#2563eb;
  --accent:#25D366;
  --bg:#ffffff;
  --shadow:0 6px 22px rgba(16,24,40,.06);
  --radius:10px;
}

/* Reset & base */
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{
  background:#f6f7fb;
  color:var(--ink);
  font-family:'Cairo',system-ui,sans-serif;
  line-height:1.6;
  font-size:16px;
  -webkit-font-smoothing:antialiased;
}
a{color:var(--primary);text-decoration:none}
.container{max-width:var(--wrap);margin:18px auto;padding:0 20px}

/* Header & Footer includes will replace these blocks */
.header-placeholder{display:block}

/* Title block */
.title-block{
  text-align:center;
  margin-bottom:20px;
  padding:12px 0;
}
.title-block h1{
  font-size:26px;
  font-weight:800;
  color:var(--ink);
  margin-bottom:8px;
  line-height:1.2
}
.dev-center{
  display:inline-flex;
  align-items:center;
  gap:12px;
  padding:8px 14px;
  border:1px solid var(--line);
  border-radius:18px;
  background:#fff;
  box-shadow:var(--shadow);
}

/* Search/filter row */
.controls{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
  margin-bottom:14px;
}
.controls .left, .controls .right{display:flex;gap:10px;align-items:center}
.search-input{
  border:1px solid var(--line);
  border-radius:999px;
  padding:10px 18px;
  width:360px;
  background:#fff;
  font-weight:600;
}
.select-sort{
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px 12px;
  background:#fff;
}

/* Units horizontal list */
.units-section{margin:10px 0}
.units-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;gap:10px;flex-wrap:wrap}
.tablist{display:flex;gap:8px}
.tab-btn{
  padding:8px 16px;border-radius:999px;border:1px solid var(--line);background:#fff;font-weight:700;cursor:pointer
}
.tab-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}

/* Horizontal card */
.units-list{display:flex;flex-direction:column;gap:14px}
.hcard{
  display:flex;
  gap:14px;
  background:#fff;
  border-radius:var(--radius);
  overflow:hidden;
  border:1px solid var(--line);
  box-shadow:var(--shadow);
  align-items:stretch;
}
.hcard .left{
  width:320px;
  min-width:220px;
  max-width:40%;
  position:relative;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
}
.hcard .left img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.hcard .right{
  padding:16px 18px;
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.hcard h3{font-size:18px;margin-bottom:6px}
.hcard .meta{color:var(--muted);font-size:14px;margin-bottom:10px}
.hcard .specs{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px}
.spec-pill{display:flex;align-items:center;gap:8px;background:#f8fafc;padding:8px 10px;border-radius:8px;font-weight:700;font-size:14px;color:var(--ink)}
.price-row{display:flex;align-items:center;gap:10px;justify-content:space-between}
.price{font-weight:900;color:var(--primary);font-size:18px}
.actions{display:flex;gap:10px;margin-top:10px}
.actions a, .actions button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:800}
.btn-wa{background:var(--accent);color:#fff}
.btn-call{background:var(--primary);color:#fff}
.btn-detail{background:#fff;border:1px solid var(--line);color:var(--ink)}

/* badges in image */
.badge-top{
  position:absolute;top:12px;left:12px;display:flex;flex-direction:column;gap:8px
}
.badge-top .badge{padding:6px 10px;border-radius:8px;color:#fff;font-weight:800;font-size:13px;box-shadow:0 6px 18px rgba(0,0,0,.12)}
.badge-dev{background:#2563eb}
.badge-resale{background:#f59e0b}
.badge-available{background:#10b981}
.badge-sold{background:#dc2626}

/* slider-thumbs (project images) */
.slider-thumbs{display:flex;gap:10px;overflow-x:auto;padding:6px 0}
.slider-thumbs img{flex:0 0 260px;height:170px;object-fit:cover;border-radius:10px;cursor:pointer;border:2px solid transparent}
.slider-thumbs img:hover{transform:scale(1.02);border-color:var(--primary)}

/* lightbox */
#lightbox{
  position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px
}
#lbImg{max-width:94%;max-height:86%;border-radius:8px;object-fit:contain}
.lb-close,.lb-prev,.lb-next{position:absolute;color:#fff;background:rgba(0,0,0,.5);border:none;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.lb-close{top:18px;left:18px;font-size:26px}
.lb-prev{left:18px;top:50%;transform:translateY(-50%)}
.lb-next{right:18px;top:50%;transform:translateY(-50%)}

/* help sidebar */
.help{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);position:sticky;top:90px}
.help .help-icon{width:65px;height:65px;margin-bottom:10px}

/* footer include placeholder */
.footer-placeholder{display:block;margin-top:24px}

/* responsive */
@media(max-width:980px){
  .hcard{flex-direction:column}
  .hcard .left{width:100%;height:220px;min-width:unset}
  .controls{flex-direction:column;align-items:stretch}
  .search-input{width:100%}
}
</style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

<!-- Header include: replaced with your template include -->
{% include header-ar.html %}

<div class="container">

  <!-- Breadcrumb -->
  <div class="breadcrumb" style="text-align:right;color:var(--muted);margin:10px 0">
    <a href="https://islamproperty.com">الرئيسية</a> » 
    <a href="https://islamproperty.com/sokhna">العين السخنة</a> » 
    <span>مشروع مورانو</span>
  </div>

  <!-- Title -->
  <div class="title-block">
    <h1>قرية مورانو وادي دجلة العين السخنة - شاليهات وفيلات للبيع بالتقسيط</h1>
    <a href="https://islamproperty.com/wadi-degla" class="dev-center" style="margin-top:6px">
      <img src="https://e.top4top.io/p_3563069vg0.jpg" alt="Wadi Degla" style="height:34px;border-radius:6px" onerror="this.src='https://f.top4top.io/p_3562107rr0.png'">
      <div class="dev-badge" style="font-weight:800;margin-right:8px">المطور: وادي دجلة للتنمية العقارية</div>
    </a>
  </div>

  <!-- Controls: Search / Sort / Tabs -->
  <div class="controls">
    <div class="left">
      <input id="globalSearch" class="search-input" placeholder="ابحث عن كود أو عنوان الوحدة أو كلمة...">
      <select id="sortSelect" class="select-sort" aria-label="ترتيب">
        <option value="">ترتيب: الافتراضي</option>
        <option value="price-asc">السعر (الأقل → الأعلى)</option>
        <option value="price-desc">السعر (الأعلى → الأقل)</option>
        <option value="area-asc">المساحة (الأقل → الأعلى)</option>
        <option value="area-desc">المساحة (الأعلى → الأقل)</option>
      </select>
    </div>

    <div class="right">
      <div class="tablist" role="tablist" aria-label="تصفية الوحدات">
        <button class="tab-btn active" data-filter="all">الكل</button>
        <button class="tab-btn" data-filter="developer">المطور</button>
        <button class="tab-btn" data-filter="resale">إعادة بيع</button>
      </div>
      <a class="show-all-link" href="https://islamproperty.com/murano-units" style="padding:8px 12px;border-radius:8px;background:#fff;border:1px solid var(--primary);color:var(--primary);font-weight:800;margin-right:8px">عرض الكل</a>
    </div>
  </div>

  <!-- Units section -->
  <section class="units-section">
    <div class="units-box" style="padding:14px;background:transparent;border:none">
      <div id="unitsList" class="units-list">
        <div style="text-align:center;color:var(--muted);padding:30px">جاري تحميل الوحدات...</div>
      </div>
    </div>
  </section>

  <!-- Media -->
  <section class="media-wrap">
    <div class="video-card" style="margin-bottom:14px">
      <h3 style="text-align:right">فيديو عن مشروع مورانو وادي دجلة</h3>
      <video controls playsinline preload="metadata" poster="https://c.top4top.io/p_35249hfap2.jpg" controlsList="nodownload" oncontextmenu="return false" disablePictureInPicture style="width:100%;border-radius:10px">
        <source src="https://i.top4top.io/m_3524euftk0.mp4" type="video/mp4">
        متصفحك لا يدعم تشغيل الفيديو.
      </video>
    </div>

    <div class="section" style="margin-bottom:18px">
      <h3 style="text-align:right">صور مشروع مورانو العين السخنة</h3>
      <div class="slider-thumbs" id="projectThumbs">
        <img src="https://c.top4top.io/p_35249hfap2.jpg" alt="Murano 1" loading="lazy" onclick="openLBFromGallery(0)">
        <img src="https://b.top4top.io/p_3524bqo0h1.jpg" alt="Murano 2" loading="lazy" onclick="openLBFromGallery(1)">
        <img src="https://a.top4top.io/p_3524wj4b00.jpg" alt="Murano 3" loading="lazy" onclick="openLBFromGallery(2)">
        <img src="https://d.top4top.io/p_35241i6053.jpg" alt="Murano 4" loading="lazy" onclick="openLBFromGallery(3)">
        <img src="https://e.top4top.io/p_3524z9c0n4.jpg" alt="Murano 5" loading="lazy" onclick="openLBFromGallery(4)">
        <img src="https://f.top4top.io/p_3524tljl25.jpg" alt="Murano 6" loading="lazy" onclick="openLBFromGallery(5)">
      </div>
      <div class="share-row" style="text-align:center;margin-top:12px">
        <button class="btn-share" onclick="sharePage()" style="padding:8px 14px;border-radius:8px;border:1px solid var(--line)">مشاركة الصفحة</button>
        <button class="btn-copy" onclick="copyLink()" style="padding:8px 14px;border-radius:8px;border:1px solid var(--line)">نسخ رابط الصفحة</button>
      </div>
    </div>

    <div class="masterplan">
      <div class="master-btn" onclick="openMaster()" style="display:flex;justify-content:center">
        <img src="https://i.top4top.io/p_3563id7jh0.png" alt="master" class="master-icon" style="height:18px;margin-left:8px">
        عرض الماستر بلان (المخطط العام)
      </div>
    </div>
  </section>

  <!-- Content & Sidebar -->
  <div class="wrap2" style="display:grid;grid-template-columns:2.5fr 1fr;gap:20px;margin-top:20px">
    <main class="content-section">
      <h2>عن مشروع مورانو وادي دجلة</h2>
      <p>تُعد قرية مورانو العين السخنة ملاذاً هادئاً بعيدًا عن زحام وضوضاء المدينة وفي ذات الوقت تبعد مسافة ليست بالطويلة، فيمكن السفر منها وإليها بكل سهولة وفي وقت قياسي. تُقدم مورانو تجربة فريدة تجمع بين سحر الطبيعة ورفاهية الحياة العصرية، وتم تصميم المشروع بعناية لتوفير بيئة استثنائية تُركز على الهدوء، مع مرافق وخدمات متكاملة.</p>

      <h2>موقع قرية مورانو العين السخنة</h2>
      <p>تقع قرية مورانو في نهاية طريق العين السخنة وبداية طريق الزعفرانة، مما يجعلها من أقرب المناطق الساحلية إلى القاهرة، مع سهولة الوصول عبر المحاور الرئيسية.</p>
      <h3>أهم الطرق والمحاور بالقرب من مورانو</h3>
      <ul>
        <li>طريق الجلالة — تقريباً 18 كم</li>
        <li>محطة قطار العين السخنة — تقريباً 14 كم</li>
        <li>المسافة إلى القاهرة — تقريباً 136 كم</li>
        <li>طريق القطامية — تقريباً 112 كم</li>
      </ul>

      <h2>ماستر بلان ومرافق</h2>
      <p>يشمل المشروع شاطئًا رمليًا بطول 750 متر، مارينا، حمامات سباحة، مطاعم وكافيهات، مناطق ترفيه للأطفال، نادي صحي وسبا، مرافق رياضية، ومنطقة تجارية متكاملة.</p>

      <h2>أنواع الوحدات</h2>
      <ul>
        <li>شاليهات بمساحات مختلفة</li>
        <li>شقق فندقية</li>
        <li>فلل مستقلة وتوين هاوس</li>
      </ul>

      <h2>الأسئلة الشائعة عن مشروع مورانو وادي دجلة</h2>
      <p style="color:var(--muted);font-size:14px;margin-top:6px">اضغط على أي سؤال لعرض الإجابة</p>
      <div id="faqList">
        <!-- FAQ will be rendered by JS -->
      </div>
    </main>

    <aside class="help">
      <img src="https://c.top4top.io/p_3563kzyu40.png" alt="help" class="help-icon" onerror="this.src='https://f.top4top.io/p_3562107rr0.png'">
      <h3>تحتاج إلى استشارة عقارية؟</h3>
      <p>املأ بياناتك وسنعاود الاتصال بك قريباً لمعرفة أفضل العروض</p>

      <div style="text-align:right;margin-top:6px">
        <label for="hName">الاسم الكامل</label>
        <input id="hName" placeholder="الاسم الكامل" required>

        <label for="hPhone">الهاتف المحمول</label>
        <input id="hPhone" placeholder="+20 10xxxxxxxx" required>

        <label for="hEmail">البريد الإلكتروني (اختياري)</label>
        <input id="hEmail" placeholder="you@example.com">

        <label for="hProject">المشروع المحدد</label>
        <input id="hProject" value="Murano Wadi Degla Sokhna" readonly>

        <label for="hUnit">نوع الوحدة المهتم بها</label>
        <select id="hUnit">
          <option>شاليه</option>
          <option>شقة فندقية</option>
          <option>فيلا</option>
          <option>توين هاوس</option>
          <option>شقة</option>
        </select>

        <label for="hBudget">الميزانية التقريبية</label>
        <input id="hBudget" placeholder="مثال: من 2,500,000 إلى 4,000,000 ج.م">

        <label for="hNote">ملاحظة / تفاصيل إضافية</label>
        <textarea id="hNote" placeholder="اذكر موعد التسليم أو نظام السداد المفضل..."></textarea>

        <button id="hWA">إرسال استفساري عبر واتساب</button>
        <button id="hMail">إرسال عبر إيميل</button>
      </div>
    </aside>
  </div>

  <!-- Footer include -->
  {% include footer-ar.html %}

</div>

<!-- Lightbox -->
<div id="lightbox" aria-hidden="true">
  <button class="lb-close" aria-label="إغلاق">×</button>
  <button class="lb-prev" aria-label="السابق">‹</button>
  <img id="lbImg" src="" alt="preview">
  <button class="lb-next" aria-label="التالي">›</button>
</div>

<!-- Floating Buttons -->
<a class="fab-wa" href="https://wa.me/201050072527" target="_blank" rel="noopener" title="واتساب">
  <img src="https://i.top4top.io/p_3537mv0672.png" alt="WhatsApp" style="width:28px;height:28px;filter:invert(1)">
</a>
<a class="fab-call" href="tel:+201050072527" title="اتصال مباشر" style="text-decoration:none;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700">☎</a>

<!-- Scripts -->
<script>
/* ---------- Utility helpers ---------- */
function parseNumberFromString(s){
  if(!s && s !== 0) return NaN;
  try{
    if(typeof s === 'number') return s;
    s = String(s).replace(/,/g,'').replace(/[^\d.-]/g,'').trim();
    return s === '' ? NaN : Number(s);
  }catch(e){return NaN;}
}
function fmtEG(n){ try { return new Intl.NumberFormat('ar-EG').format(n); } catch(e){ return n; } }

/* ---------- State ---------- */
let ALL_UNITS = []; // loaded from murano-units.json or fallback
let FILTER = 'all';
let SEARCH_Q = '';
let SORT = ''; // e.g. "price-asc"

/* ---------- Elements ---------- */
const unitsListEl = document.getElementById('unitsList');
const tabBtns = document.querySelectorAll('.tab-btn');
const searchInput = document.getElementById('globalSearch');
const sortSelect = document.getElementById('sortSelect');

/* ---------- Fetch units (from murano-units.json) ---------- */
async function loadUnits(){
  try{
    const resp = await fetch('murano-units.json', {cache:'no-store'});
    if(!resp.ok) throw new Error('no json');
    const data = await resp.json();
    if(Array.isArray(data) && data.length) {
      ALL_UNITS = data;
      return;
    }
  }catch(e){
    // fallback sample if fetch failed
    ALL_UNITS = [
      {id:101, title:"شاليه 2 غرف - واجهة بحرية", status:"available", type:"developer", link:"/murano-units#101", price:"4,800,000", bed:"2", bath:1, area:"105 م²", images:["https://c.top4top.io/p_35249hfap2.jpg","https://b.top4top.io/p_3524bqo0h1.jpg"], city:"العين السخنة"},
      {id:102, title:"شقة فندقية 1 غرفة", status:"available", type:"resale", link:"/murano-units#102", price:"2,750,000", bed:"1", bath:1, area:"75 م²", images:["https://a.top4top.io/p_3524wj4b00.jpg","https://d.top4top.io/p_35241i6053.jpg"], city:"العين السخنة"},
      {id:103, title:"فيلا مستقلة 4 غرف", status:"available", type:"developer", link:"/murano-units#103", price:"5,500,000", bed:"4", bath:3, area:"240 م²", images:["https://f.top4top.io/p_3524tljl25.jpg"], city:"العين السخنة"}
    ];
  }
}

/* ---------- Render single horizontal card ---------- */
function createHCard(u){
  const div = document.createElement('article');
  div.className = 'hcard';
  div.setAttribute('data-id', u.id);

  // left: image
  const left = document.createElement('div'); left.className='left';
  const img = document.createElement('img');
  img.src = (u.images && u.images[0]) ? u.images[0] : 'https://picsum.photos/seed/unit/800/600';
  img.alt = u.title || '';
  img.loading = 'lazy';
  img.style.cursor = 'pointer';
  img.addEventListener('click', (e)=>{ e.stopPropagation(); openLBForUnit(u,0); });
  left.appendChild(img);

  // badges
  const badgeWrap = document.createElement('div'); badgeWrap.className='badge-top';
  const bType = document.createElement('div'); bType.className='badge ' + (u.type === 'developer' ? 'badge-dev' : 'badge-resale');
  bType.textContent = (u.type === 'developer' ? 'مطور' : 'إعادة بيع');
  const bStatus = document.createElement('div'); bStatus.className='badge ' + (u.status === 'available' ? 'badge-available' : 'badge-sold');
  bStatus.textContent = (u.status === 'available' ? 'متاح' : 'مباع');
  badgeWrap.appendChild(bType); badgeWrap.appendChild(bStatus);
  left.appendChild(badgeWrap);

  // right: details
  const right = document.createElement('div'); right.className='right';
  const title = document.createElement('h3'); title.textContent = `${u.title || 'وحدة'} - كود #${u.id}`;
  const meta = document.createElement('div'); meta.className='meta'; meta.textContent = u.city || '';
  const specs = document.createElement('div'); specs.className='specs';
  // bed
  if(u.bed){
    const s1 = document.createElement('div'); s1.className='spec-pill'; s1.innerHTML = `🛏 ${u.bed}`;
    specs.appendChild(s1);
  }
  if(u.bath){
    const s2 = document.createElement('div'); s2.className='spec-pill'; s2.innerHTML = `🚿 ${u.bath} حمام`;
    specs.appendChild(s2);
  }
  if(u.area){
    const s3 = document.createElement('div'); s3.className='spec-pill'; s3.innerHTML = `📐 ${u.area}`;
    specs.appendChild(s3);
  }

  const priceRow = document.createElement('div'); priceRow.className='price-row';
  const priceDiv = document.createElement('div'); priceDiv.className='price';
  // normalize price to number if possible
  let priceNum = parseNumberFromString(u.price);
  priceDiv.textContent = u.price ? (`ج.م ${ isFinite(priceNum) ? fmtEG(priceNum) : u.price }`) : 'اتصل لمعرفة السعر';
  priceRow.appendChild(priceDiv);

  // actions
  const actions = document.createElement('div'); actions.className='actions';
  // whatsapp button
  const wa = document.createElement('a'); wa.className='btn-wa'; wa.innerHTML='واتساب';
  wa.href = `https://wa.me/201050072527?text=${encodeURIComponent(`السلام عليكم، أريد تفاصيل عن الوحدة ${u.title || ''} - كود #${u.id} في مشروع مورانو`)}`;
  wa.target = '_blank'; wa.rel='noopener';
  // call button
  const call = document.createElement('a'); call.className='btn-call'; call.innerHTML='اتصال';
  call.href = 'tel:+201050072527';
  // detail button
  const det = document.createElement('a'); det.className='btn-detail'; det.innerHTML='تفاصيل';
  det.href = u.link || '#';
  det.onclick = (e)=>{ /* allow default */ };

  actions.appendChild(wa); actions.appendChild(call); actions.appendChild(det);

  // assemble right side
  right.appendChild(title);
  right.appendChild(meta);
  right.appendChild(specs);
  right.appendChild(priceRow);
  right.appendChild(actions);

  // assemble card
  div.appendChild(left);
  div.appendChild(right);

  // click entire card -> open details link if exists
  div.addEventListener('click', ()=>{ if(u.link) window.location.href = u.link; });

  return div;
}

/* ---------- Render units list with filters/sort/search ---------- */
function applyFiltersAndRender(){
  let list = ALL_UNITS.slice();

  // filter by tab
  if(FILTER && FILTER !== 'all'){
    list = list.filter(u => (String(u.type || '').toLowerCase()) === FILTER);
  }

  // search
  if(SEARCH_Q){
    const q = SEARCH_Q.trim().toLowerCase();
    list = list.filter(u=>{
      const hay = ((u.title||'') + ' ' + (u.id||'') + ' ' + (u.city||'') + ' ' + (u.area||'') + ' ' + (u.price||'')).toLowerCase();
      return hay.includes(q);
    });
  }

  // sort
  if(SORT){
    const [key, dir] = SORT.split('-');
    list.sort((a,b)=>{
      if(key === 'price'){
        const A = parseNumberFromString(a.price);
        const B = parseNumberFromString(b.price);
        if(isNaN(A) && isNaN(B)) return 0;
        if(isNaN(A)) return 1; if(isNaN(B)) return -1;
        return dir === 'asc' ? A - B : B - A;
      } else if(key === 'area'){
        const A = parseNumberFromString(a.area);
        const B = parseNumberFromString(b.area);
        if(isNaN(A) && isNaN(B)) return 0;
        if(isNaN(A)) return 1; if(isNaN(B)) return -1;
        return dir === 'asc' ? A - B : B - A;
      }
      return 0;
    });
  }

  // render
  unitsListEl.innerHTML = '';
  if(!list.length){
    unitsListEl.innerHTML = '<div style="padding:30px;color:var(--muted);text-align:center">لا توجد وحدات تطابق البحث/الفلاتر حالياً</div>';
    return;
  }
  const frag = document.createDocumentFragment();
  list.forEach(u => frag.appendChild(createHCard(u)));
  unitsListEl.appendChild(frag);
}

/* ---------- Tabs, Search, Sort event wiring ---------- */
tabBtns.forEach(btn=>{
  btn.addEventListener('click', function(){
    tabBtns.forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    FILTER = this.getAttribute('data-filter') || 'all';
    applyFiltersAndRender();
  });
});
searchInput.addEventListener('input', (e)=>{
  SEARCH_Q = e.target.value;
  applyFiltersAndRender();
});
sortSelect.addEventListener('change', (e)=>{
  SORT = e.target.value;
  applyFiltersAndRender();
});

/* ---------- Lightbox (global & per-unit) ---------- */
const lb = document.getElementById('lightbox');
const lbImg = document.getElementById('lbImg');
let lbSet = []; let lbIndex = 0;
function openLB(set,i){
  lbSet = Array.isArray(set) ? set : [];
  lbIndex = (i || 0) % (lbSet.length || 1);
  lbImg.src = lbSet[lbIndex] || '';
  lb.style.display = 'flex';
  lb.setAttribute('aria-hidden','false');
}
function closeLB(){ lb.style.display='none'; lb.setAttribute('aria-hidden','true'); lbImg.src=''; }
function lbNext(){ if(!lbSet.length) return; lbIndex = (lbIndex+1)%lbSet.length; lbImg.src = lbSet[lbIndex]; }
function lbPrev(){ if(!lbSet.length) return; lbIndex = (lbIndex-1+lbSet.length)%lbSet.length; lbImg.src = lbSet[lbIndex]; }

document.querySelector('.lb-close').addEventListener('click', closeLB);
document.querySelector('.lb-next').addEventListener('click', lbNext);
document.querySelector('.lb-prev').addEventListener('click', lbPrev);
lb.addEventListener('click', function(e){ if(e.target === lb) closeLB(); });
document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeLB(); if(e.key === 'ArrowRight') lbNext(); if(e.key === 'ArrowLeft') lbPrev(); });

function openLBForUnit(unit, idx){
  if(!unit || !unit.images || !unit.images.length) return;
  openLB(unit.images, idx || 0);
}
function openLBFromGallery(i){
  const gallery = [
    "https://c.top4top.io/p_35249hfap2.jpg",
    "https://b.top4top.io/p_3524bqo0h1.jpg",
    "https://a.top4top.io/p_3524wj4b00.jpg",
    "https://d.top4top.io/p_35241i6053.jpg",
    "https://e.top4top.io/p_3524z9c0n4.jpg",
    "https://f.top4top.io/p_3524tljl25.jpg"
  ];
  openLB(gallery, i || 0);
}
function openMaster(){ openLB(["https://b.top4top.io/p_3563snvkk0.png"], 0); }

/* ---------- Share / Copy ---------- */
function copyLink(){
  navigator.clipboard?.writeText(window.location.href).then(()=> alert('✓ تم نسخ رابط الصفحة بنجاح')).catch(()=> alert('تعذر نسخ الرابط'));
}
function sharePage(){
  if(navigator.share) navigator.share({title: document.title, url: window.location.href}).catch(()=>{});
  else copyLink();
}

/* ---------- Help form actions ---------- */
function getVal(id){ return (document.getElementById(id)?.value||'').trim(); }
document.getElementById('hWA').addEventListener('click', ()=> {
  const txt = `مرحباً، أرجو تزويدي بتفاصيل مشروع ${getVal('hProject')} - الاسم: ${getVal('hName')} - الهاتف: ${getVal('hPhone')} - الإيميل: ${getVal('hEmail')} - نوع الوحدة: ${getVal('hUnit')} - الميزانية: ${getVal('hBudget')} - ملاحظة: ${getVal('hNote')}`;
  window.open(`https://wa.me/201050072527?text=${encodeURIComponent(txt)}`,'_blank');
});
document.getElementById('hMail').addEventListener('click', ()=> {
  const subj = `استفسار عن ${getVal('hProject')} - ${getVal('hName')}`;
  const body = `الاسم: ${getVal('hName')}\nالهاتف: ${getVal('hPhone')}\nالإيميل: ${getVal('hEmail')}\nالمشروع: ${getVal('hProject')}\nنوع الوحدة: ${getVal('hUnit')}\nالميزانية: ${getVal('hBudget')}\nملاحظات:\n${getVal('hNote')}`;
  location.href = `mailto:islammesmail@gmail.com?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(body)}`;
});

/* ---------- FAQ render ---------- */
(function renderFAQ(){
  const faqData = [
    {q:"ما هو موقع مشروع مورانو بالتحديد؟", a:"يقع مشروع مورانو في منطقة الزعفرانة / العين السخنة على محور يربط بين القاهرة والساحل الشرقي. الموقع يجعل الوصول إليه سريعاً من العاصمة."},
    {q:"ما هي خيارات السداد المتاحة؟", a:"يوجد أنظمة سداد مرنة تختلف حسب المطور والوحدة، وتتراوح فترات السداد من سنوات قصيرة إلى 7 سنوات أو حسب العرض."},
    {q:"هل توجد وحدات واجهة بحرية؟", a:"نعم، يحتوي المشروع على وحدات بواجهات بحرية وشواطئ خاصة بمساحات مختلفة."},
    {q:"ما مواعيد التسليم المتوقعة؟", a:"تواريخ التسليم تختلف حسب نوع الوحدة والخطة، يرجى التواصل معنا للحصول على أحدث الجداول."}
  ];
  const el = document.getElementById('faqList');
  faqData.forEach((f, idx) => {
    const item = document.createElement('div'); item.className='faq-item';
    const q = document.createElement('div'); q.className='faq-q'; q.innerHTML = `<span>${f.q}</span><span>▾</span>`;
    const a = document.createElement('div'); a.className='faq-a'; a.textContent = f.a;
    q.addEventListener('click', ()=> {
      const open = item.classList.toggle('open');
      a.style.display = open ? 'block' : 'none';
    });
    item.appendChild(q); item.appendChild(a);
    el.appendChild(item);
  });
})();

/* ---------- Init ---------- */
(async function init(){
  await loadUnits();
  applyFiltersAndRender();
})();
</script>

</body>
</html>
