<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>تفاصيل الوحدة — Murano</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
:root{--wrap:980px;--line:#e5e7eb;--ink:#0f172a;--muted:#64748b;--brand:#0b3a5e}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:"Cairo",system-ui;padding:12px;background:#f8fafc;color:var(--ink)}
.container{max-width:var(--wrap);margin:auto}

/* layout */
.unit{background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 8px 30px rgba(2,8,23,.06);overflow:hidden}
.top{display:grid;grid-template-columns:1fr;gap:12px;padding:12px}
@media(min-width:900px){.top{grid-template-columns:1fr 360px;align-items:start}}

/* slider */
.slider{position:relative;border-radius:10px;overflow:hidden}
.slider img{width:100%;height:320px;object-fit:cover;display:block}
.sl-controls{position:absolute;top:50%;transform:translateY(-50%);width:100%;display:flex;justify-content:space-between;padding:0 8px}
.sl-btn{background:rgba(255,255,255,.95);border:0;padding:8px;border-radius:50%;cursor:pointer;font-size:20px;box-shadow:0 6px 18px rgba(2,8,23,.08)}
.thumbs{display:flex;gap:8px;margin-top:8px;overflow-x:auto;padding-bottom:6px}
.thumbs img{width:84px;height:64px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid transparent}
.thumbs img.active{border-color:var(--brand)}

/* details */
.meta{padding:12px}
.title{display:flex;gap:10px;align-items:center;justify-content:space-between}
.title h2{margin:0;font-size:20px}
.price{font-size:20px;font-weight:900}
.badge{padding:6px 10px;border-radius:10px;color:#fff;font-weight:900}
.badge.dev{background:#0ea5e9}
.badge.resale{background:#10b981}
.specs{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
.spec{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;background:#f8fafc;border:1px solid var(--line);font-weight:800}
.spec img{width:18px;height:18px}

/* payment & desc */
.pay{padding:12px;border-top:1px dashed var(--line);display:flex;flex-direction:column;gap:10px}
.pay .row{display:flex;gap:10px;align-items:center;justify-content:space-between}
.desc{padding:12px;border-top:1px dashed var(--line)}

/* contact */
.contact{padding:12px;border-top:1px dashed var(--line);display:flex;gap:8px;flex-direction:column}
.btn{display:inline-block;background:#111827;color:#fff;padding:10px 12px;border-radius:10px;text-decoration:none;font-weight:900;text-align:center}

/* small */
@media(max-width:520px){.slider img{height:220px}}
</style>
</head>
<body>
  <div class="container">
    <a href="murano-units.html" style="display:inline-block;margin-bottom:12px;color:var(--brand);font-weight:900;text-decoration:none">← رجوع للوحدات</a>
    <div class="unit" id="unitWrap">
      <div class="top">
        <div>
          <div class="slider" id="slider">
            <img id="mainImg" src="" alt="">
            <div class="sl-controls">
              <button class="sl-btn" id="prev">‹</button>
              <button class="sl-btn" id="next">›</button>
            </div>
          </div>
          <div class="thumbs" id="thumbs"></div>
        </div>

        <aside style="min-width:240px">
          <div class="meta">
            <div class="title">
              <h2 id="unitTitle">—</h2>
              <div>
                <span id="badge" class="badge">نوع</span>
              </div>
            </div>

            <div style="margin-top:8px;color:var(--muted)" id="unitCity">موقع الوحدة</div>
            <div class="specs" style="margin-top:12px">
              <div class="spec"><img src="https://l.top4top.io/p_35485t5zz0.png" alt=""> <span id="unitArea">- م²</span></div>
              <div class="spec"><img src="https://b.top4top.io/p_3548n15ar2.png" alt=""> <span id="unitBath">- حمام</span></div>
              <div class="spec"><img src="https://a.top4top.io/p_3548e8beq1.png" alt=""> <span id="unitBed">- غرف</span></div>
            </div>

            <div style="margin-top:12px">
              <div class="price" id="priceBlock">جم -</div>
            </div>
          </div>

          <div style="padding:12px">
            <a id="waBtn" class="btn" href="#" target="_blank">استفسر عبر واتساب</a>
            <a id="emailBtn" class="btn" href="#" style="background:#0b3a5e">إرسال عبر الإيميل</a>
          </div>
        </aside>
      </div>

      <div class="pay" id="payInfo">
        <div style="font-weight:900">تفاصيل الدفع</div>
        <div class="row" id="payRows">
          <!-- سيتم إدخال صفوف الدفع هنا -->
        </div>
        <div style="color:var(--muted);font-size:13px" id="planNote"></div>
      </div>

      <div class="desc">
        <h3 style="margin:0 0 6px">وصف الوحدة</h3>
        <p id="unitDesc" style="margin:0;color:#374151"></p>
      </div>

      <div class="contact">
        <h3 style="margin:0 0 6px">استعلام</h3>
        <input id="leadName" placeholder="اسمك" style="padding:10px;border-radius:8px;border:1px solid var(--line)">
        <input id="leadPhone" placeholder="رقم الهاتف" style="padding:10px;border-radius:8px;border:1px solid var(--line)">
        <textarea id="leadNote" placeholder="ملاحظات..." style="padding:10px;border-radius:8px;border:1px solid var(--line);min-height:90px"></textarea>
        <div style="display:flex;gap:8px">
          <button id="sendWA" class="btn" style="flex:1">أرسل عبر واتساب</button>
          <button id="sendMail" class="btn" style="flex:1;background:#0b3a5e">أرسل عبر إيميل</button>
        </div>
      </div>

    </div>
  </div>

<script>
/* استخراج الـ id من اسم الملف (مثلاً murano-units101.html -> 101) */
const path = location.pathname.split('/').pop() || '';
const m = path.match(/(\d+)/);
const unitId = m ? m[1] : (location.search.replace('?id=','') || location.hash.replace('#',''));

/* أيقونات */
const ICON_BED ="https://a.top4top.io/p_3548e8beq1.png";
const ICON_BATH="https://b.top4top.io/p_3548n15ar2.png";
const ICON_AREA="https://l.top4top.io/p_35485t5zz0.png";

function nf(n){ return new Intl.NumberFormat('ar-EG').format(n) }

async function loadUnit(){
  try{
    const res = await fetch('murano-units.json');
    const units = await res.json();
    const u = units.find(x=>x.id === unitId);
    if(!u){
      document.getElementById('unitWrap').innerHTML = '<div style="padding:20px">الوحدة غير موجودة في القاعدة (تأكد من JSON واسم الملف).</div>';
      return;
    }

    // Header info
    document.getElementById('unitTitle').textContent = u.title;
    document.getElementById('badge').textContent = u.type;
    document.getElementById('badge').className = 'badge ' + (u.typeClass==='dev'?'dev':'resale');
    document.getElementById('unitCity').textContent = u.city||'';
    document.getElementById('unitArea').textContent = u.area + ' م²';
    document.getElementById('unitBath').textContent = u.bath + ' حمام';
    document.getElementById('unitBed').textContent = u.bed + ' غرف';
    document.getElementById('unitDesc').textContent = u.desc || u.shortDesc || '';

    // Images (slider)
    const imgs = (u.images && u.images.length) ? u.images : [u.img||'https://l.top4top.io/p_3547oj09j1.jpg'];
    const mainImg = document.getElementById('mainImg');
    const thumbs = document.getElementById('thumbs');
    let idx = 0;
    mainImg.src = imgs[0];
    thumbs.innerHTML = imgs.map((s,i)=>`<img src="${s}" data-i="${i}" alt="thumb-${i}" ${i===0?'class="active"':''}>`).join('');

    function show(i){
      idx = i;
      mainImg.src = imgs[i];
      [...thumbs.querySelectorAll('img')].forEach(t=>t.classList.remove('active'));
      thumbs.querySelector(`img[data-i="${i}"]`)?.classList.add('active');
    }
    document.getElementById('next').addEventListener('click',()=> show((idx+1)%imgs.length));
    document.getElementById('prev').addEventListener('click',()=> show((idx-1+imgs.length)%imgs.length));
    thumbs.addEventListener('click',(e)=>{ const t=e.target; if(t.tagName==='IMG'){ show(+t.dataset.i) }});

    // swipe support on main image
    (function(){
      const s=document.getElementById('mainImg');
      let d=false,x0,sl;
      s.addEventListener('pointerdown',e=>{d=true; x0=e.clientX});
      s.addEventListener('pointermove',e=>{ if(!d) return; const dx = e.clientX - x0; if(Math.abs(dx) > 50){ if(dx<0) show((idx+1)%imgs.length); else show((idx-1+imgs.length)%imgs.length); d=false }});
      ['pointerup','pointercancel','mouseleave'].forEach(ev=>s.addEventListener(ev,()=>d=false));
    })();

    // Price & payment
    const priceBlock = document.getElementById('priceBlock');
    const payRows = document.getElementById('payRows');
    const planNote = document.getElementById('planNote');
    priceBlock.textContent = 'جم ' + nf(u.price) + (u.payment && u.payment.type==='cash' ? ' • كاش' : '');
    payRows.innerHTML = '';

    if(u.payment && u.payment.type === 'cash'){
      payRows.innerHTML = `<div style="flex:1">الدفع: كاش</div><div style="font-weight:900">السعر: جم ${nf(u.price)}</div>`;
      planNote.textContent = 'وحدة معروضة كـ (كاش).';
    } else if(u.payment && u.payment.type === 'installment'){
      const dp = Number(u.payment.downPercent || 0);
      const years = Number(u.payment.years || 1);
      const down = Math.round(u.price * dp / 100);
      const remaining = u.price - down;
      const months = years * 12;
      const monthly = Math.round(remaining / months);
      const quarterly = monthly * 3;

      payRows.innerHTML = `
        <div style="flex:1">المقدم: <strong>${dp}%</strong> (جم ${nf(down)})</div>
        <div style="flex:1;text-align:left">الاقساط: <strong>${years} سنة</strong></div>
      `;
      const extra = document.createElement('div');
      extra.style.marginTop = '8px';
      extra.innerHTML = `<div>كل 3 شهور: <strong>جم ${nf(quarterly)}</strong> (تقريباً)</div>
                         <div>القسط الشهري التقريبي: جم ${nf(monthly)}</div>
                         <div>المتبقي بعد المقدم: جم ${nf(remaining)}</div>`;
      payRows.appendChild(extra);

      planNote.textContent = `خطة: ${years} سنة — الأرقام تقريبية وتحتاج تأكيد من قسم المبيعات.`;
    } else {
      payRows.innerHTML = `<div>تفاصيل الدفع: عند الطلب</div>`;
      planNote.textContent = '';
    }

    // WA / mail links
    const waBtn = document.getElementById('waBtn');
    const emailBtn = document.getElementById('emailBtn');
    const contactText = `مرحباً، أود الاستفسار عن: ${u.title} (ID: ${u.id})\nالسعر: ${nf(u.price)}\n${u.payment?.type==='installment' ? 'قسط • مقدم '+(u.payment.downPercent||0)+'%':''}`;
    waBtn.href = `https://wa.me/201050072527?text=${encodeURIComponent(contactText)}`;
    emailBtn.href = `mailto:islammesmail@gmail.com?subject=${encodeURIComponent('استفسار عن '+u.title)}&body=${encodeURIComponent(contactText)}`;

    // ارسال استعلام من الفورم
    document.getElementById('sendWA').addEventListener('click',()=>{
      const name=document.getElementById('leadName').value.trim(), phone=document.getElementById('leadPhone').value.trim(), note=document.getElementById('leadNote').value.trim();
      const txt = `مرحباً، استعلام عن ${u.title} (ID: ${u.id}).\nالاسم: ${name}\nالهاتف: ${phone}\nملاحظات: ${note}`;
      window.open(`https://wa.me/201050072527?text=${encodeURIComponent(txt)}`,'_blank');
    });
    document.getElementById('sendMail').addEventListener('click',()=>{
      const name=document.getElementById('leadName').value.trim(), phone=document.getElementById('leadPhone').value.trim(), note=document.getElementById('leadNote').value.trim();
      const body = `الاسم: ${name}\nالهاتف: ${phone}\nالملاحظات: ${note}\n\nاستعلام عن ${u.title} (ID: ${u.id}).`;
      location.href = `mailto:islammesmail@gmail.com?subject=${encodeURIComponent('استعلام عن '+u.title)}&body=${encodeURIComponent(body)}`;
    });

  }catch(err){
    console.error(err);
    document.getElementById('unitWrap').innerHTML = '<div style="padding:20px">خطأ في تحميل بيانات الوحدة.</div>';
  }
}

loadUnit();
</script>
</body>
</html>
